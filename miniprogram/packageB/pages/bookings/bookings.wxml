<view class="bookings-page">
  <view class="mode-banner">{{mode === 'worker' ? 'æˆ‘çš„é¢„çº¦ï¼ˆé˜¿å§¨ç«¯ï¼‰' : 'æˆ‘çš„é¢„çº¦ï¼ˆé›‡ä¸»ç«¯ï¼‰'}}</view>
  <scroll-view
    class="booking-list"
    scroll-y="{{true}}"
    bindscrolltolower="onLoadMore"
    refresher-enabled="{{true}}"
    refresher-triggered="{{isRefreshing}}"
    refresher-background="#f5f5f5"
    bindrefresherrefresh="onRefresh"
  >
    <view class="list-content" wx:if="{{bookings.length > 0}}">
      <view class="booking-card" wx:for="{{bookings}}" wx:key="_id">
        <view class="header">
          <view class="worker">
            <image class="avatar" src="{{item.displayAvatar || '/images/default-avatar.png'}}" mode="aspectFill" />
            <view class="meta">
              <text class="name">{{item.displayName}}</text>
              <text class="time">æäº¤äº {{item.createdAtText}}</text>
            </view>
          </view>
          <text class="status">{{item.statusText}}</text>
        </view>

        <view class="detail-row" wx:if="{{item.serviceType}}">
          <text class="label">æœåŠ¡ç±»å‹</text>
          <text class="value">{{item.serviceTypeText}}</text>
        </view>
        <view class="detail-row" wx:if="{{item.startDate}}">
          <text class="label">å¼€å§‹æ—¶é—´</text>
          <text class="value">{{item.startDate}}</text>
        </view>
        <view class="detail-row" wx:if="{{item.duration}}">
          <text class="label">æœåŠ¡æ—¶é•¿</text>
          <text class="value">{{item.duration}}</text>
        </view>
        <view class="detail-row" wx:if="{{item.address}}">
          <text class="label">æœåŠ¡åœ°å€</text>
          <text class="value address">{{item.address}}</text>
        </view>
        <view class="detail-row" wx:if="{{item.totalPrice}}">
          <text class="label">é¢„ç®—é‡‘é¢</text>
          <text class="value price">Â¥{{item.totalPrice}}</text>
        </view>
        <view class="detail-row" wx:if="{{item.rejectReason}}">
          <text class="label">æ‹’ç»åŸå› </text>
          <text class="value">{{item.rejectReason}}</text>
        </view>
        <view class="detail-row" wx:if="{{item.interviewTime}}">
          <text class="label">é¢è¯•æ—¶é—´</text>
          <text class="value">{{item.interviewTime}}</text>
        </view>

        <view class="actions" wx:if="{{item.canCancel || item.canTerminate || item.canSubmitOrder || item.canViewOrder || item.canWorkerAccept || item.canWorkerReject || item.canWorkerContact}}">
          <button class="btn-secondary" wx:if="{{item.canCancel}}" data-booking-id="{{item._id}}" bindtap="onCancelBooking">å–æ¶ˆé¢„çº¦</button>
          <button class="btn-secondary" wx:if="{{item.canTerminate}}" data-booking-id="{{item._id}}" bindtap="onTerminateBooking">ç»ˆæ­¢é¢„çº¦</button>
          <button class="btn-primary" wx:if="{{item.canSubmitOrder}}" data-booking-id="{{item._id}}" bindtap="onSubmitOrder">æäº¤è®¢å•</button>
          <button class="btn-primary" wx:if="{{item.canViewOrder}}" data-order-id="{{item.orderId}}" bindtap="onViewOrder">æŸ¥çœ‹è®¢å•</button>

          <button class="btn-secondary" wx:if="{{item.canWorkerReject}}" data-booking-id="{{item._id}}" bindtap="onWorkerReject">æ‹’ç»</button>
          <button class="btn-primary" wx:if="{{item.canWorkerAccept}}" data-booking-id="{{item._id}}" bindtap="onWorkerAccept">æ¥å—</button>
          <button class="btn-secondary" wx:if="{{item.canWorkerContact}}" data-phone="{{item.contactPhone}}" bindtap="onWorkerContact">è”ç³»é›‡ä¸»</button>
        </view>
      </view>
    </view>

    <view class="load-status">
      <loading wx:if="{{isLoading}}" type="spinner" text="åŠ è½½ä¸­..." />
      <text class="no-more" wx:if="{{!hasMore && bookings.length > 0}}">æ²¡æœ‰æ›´å¤šäº†</text>
    </view>

    <view class="empty-state" wx:if="{{!isLoading && bookings.length === 0}}">
      <text class="empty-icon">ğŸ—‚ï¸</text>
      <text class="empty-text">{{mode === 'worker' ? 'æš‚æ— è¢«é¢„çº¦è®°å½•' : 'æš‚æ— é¢„çº¦è®°å½•'}}</text>
      <button class="btn-go" wx:if="{{mode !== 'worker'}}" bindtap="onGoWorkers">å»é¢„çº¦</button>
    </view>
  </scroll-view>
</view>
