<!-- é¦–é¡µ -->
<view class="index-page">
  <block wx:if="{{roleLoading}}">
    <view class="home-loading">
      <view class="home-loading-spinner"></view>
      <text class="home-loading-text">åŠ è½½é¦–é¡µä¸­...</text>
    </view>
  </block>

  <block wx:else>
    <block wx:if="{{!isWorkerHome && !isPlatformHome}}">
    <!-- é¡¶éƒ¨æœç´¢æ  -->
    <view class="search-header">
      <view class="search-box" bindtap="onSearchTap">
        <text class="search-icon">ğŸ”</text>
        <text class="search-placeholder">æœç´¢é˜¿å§¨å§“åã€æŠ€èƒ½...</text>
      </view>
    </view>

    <!-- è½®æ’­å›¾ -->
    <view class="banner-section">
      <swiper
        class="banner-swiper"
        indicator-dots="{{true}}"
        autoplay="{{true}}"
        interval="3000"
        duration="500"
        circular="{{true}}"
        indicator-color="rgba(255,255,255,0.5)"
        indicator-active-color="#FF6B6B"
      >
        <swiper-item wx:for="{{banners}}" wx:key="id">
          <image class="banner-image" src="{{item.image}}" mode="aspectFill" bindtap="onBannerTap" data-item="{{item}}" />
        </swiper-item>
      </swiper>
    </view>

    <!-- æœåŠ¡ç±»å‹å¿«æ·å…¥å£ -->
    <view class="service-types card">
      <view class="section-title">æœåŠ¡ç±»å‹</view>
      <view class="service-grid">
        <view class="service-item" wx:for="{{serviceTypes}}" wx:key="id" bindtap="onServiceTap" data-type="{{item.filterType}}">
          <view class="service-icon" style="background: {{item.bgColor}}">
            <text class="icon-text">{{item.icon}}</text>
          </view>
          <text class="service-name">{{item.name}}</text>
          <text class="service-desc">{{item.desc}}</text>
        </view>
      </view>
    </view>

    <!-- æœåŠ¡ä¼˜åŠ¿ -->
    <view class="advantages card">
      <view class="advantage-item" wx:for="{{advantages}}" wx:key="index">
        <text class="advantage-icon">{{item.icon}}</text>
        <text class="advantage-text">{{item.text}}</text>
      </view>
    </view>

    <!-- æ¨èé˜¿å§¨ -->
    <view class="recommend-section">
      <view class="section-header">
        <view class="section-title">æ¨èé˜¿å§¨</view>
        <view class="more-link" bindtap="onMoreTap">
          <text>æŸ¥çœ‹æ›´å¤š</text>
          <text class="arrow">></text>
        </view>
      </view>

      <view class="worker-list">
        <worker-card
          wx:for="{{recommendWorkers}}"
          wx:key="_id"
          worker="{{item}}"
          bind:cardtap="onWorkerTap"
          bind:book="onBookTap"
        />
      </view>
    </view>
    </block>

    <block wx:elif="{{isWorkerHome}}">
      <view class="worker-home">
      <view class="worker-hero card">
        <view class="worker-hero-title">æˆ‘çš„å·¥ä½œå°</view>
        <view class="worker-hero-row">
          <view>
            <text class="hero-label">æ¥å•çŠ¶æ€</text>
            <text class="hero-value {{workerSettings && workerSettings.status === 'available' ? 'online' : 'offline'}}">
              {{workerSettings && workerSettings.status === 'available' ? 'åœ¨çº¿æ¥å•' : 'æš‚åœæ¥å•'}}
            </text>
          </view>
          <view class="hero-actions">
            <button class="hero-btn" bindtap="onGoWorkerSettings">æ¥å•è®¾ç½®</button>
          </view>
        </view>
      </view>

      <view class="worker-stats card">
        <view class="stats-item">
          <text class="stats-num">{{workerStats.pendingCount}}</text>
          <text class="stats-text">å¾…å¤„ç†é¢„çº¦</text>
        </view>
        <view class="stats-item">
          <text class="stats-num">{{workerStats.interviewCount}}</text>
          <text class="stats-text">å¾…é¢è¯•å®‰æ’</text>
        </view>
        <view class="stats-item">
          <text class="stats-num">{{workerStats.orderCreatedCount}}</text>
          <text class="stats-text">å·²è½¬è®¢å•</text>
        </view>
      </view>

      <view class="worker-section card">
        <view class="section-header">
          <view class="section-title">å¾…å¤„ç†é¢„çº¦</view>
          <view class="more-link" bindtap="onGoWorkerBookings"><text>æŸ¥çœ‹æ›´å¤š ></text></view>
        </view>
        <view wx:if="{{pendingBookings.length > 0}}">
          <view class="mini-card" wx:for="{{pendingBookings}}" wx:key="_id">
            <text class="mini-title">{{item.contactName || item.userNickname || 'é›‡ä¸»'}}</text>
            <text class="mini-sub">æœåŠ¡ç±»å‹ï¼š{{item.serviceType}}</text>
            <text class="mini-sub">å¼€å§‹æ—¶é—´ï¼š{{item.startDate || '-'}}</text>
            <view class="mini-actions">
              <button class="mini-btn reject" data-booking-id="{{item._id}}" bindtap="onWorkerReject">æ‹’ç»</button>
              <button class="mini-btn accept" data-booking-id="{{item._id}}" bindtap="onWorkerAccept">æ¥å—</button>
            </view>
          </view>
        </view>
        <view wx:else class="empty-tip">æš‚æ— å¾…å¤„ç†é¢„çº¦</view>
      </view>

      <view class="worker-section card">
        <view class="section-header">
          <view class="section-title">é¢è¯•å®‰æ’</view>
          <view class="more-link" bindtap="onGoWorkerBookings"><text>æŸ¥çœ‹æ›´å¤š ></text></view>
        </view>
        <view wx:if="{{interviewBookings.length > 0}}">
          <view class="mini-card" wx:for="{{interviewBookings}}" wx:key="_id">
            <text class="mini-title">{{item.contactName || item.userNickname || 'é›‡ä¸»'}}</text>
            <text class="mini-sub">é¢è¯•æ—¶é—´ï¼š{{item.interviewTime || 'å¾…å®š'}}</text>
            <text class="mini-sub">å¤‡æ³¨ï¼š{{item.platformNote || 'è¯·å…³æ³¨å¹³å°é€šçŸ¥'}}</text>
            <view class="mini-actions">
              <button class="mini-btn contact" bindtap="onContactPlatform">è”ç³»å¹³å°</button>
            </view>
          </view>
        </view>
        <view wx:else class="empty-tip">æš‚æ— é¢è¯•å®‰æ’</view>
      </view>

      <view class="worker-section card">
        <view class="section-header">
          <view class="section-title">å·²è½¬è®¢å•</view>
          <view class="more-link" bindtap="onGoWorkerBookings"><text>æŸ¥çœ‹æ›´å¤š ></text></view>
        </view>
        <view wx:if="{{orderCreatedBookings.length > 0}}">
          <view class="mini-card" wx:for="{{orderCreatedBookings}}" wx:key="_id">
            <text class="mini-title">{{item.contactName || item.userNickname || 'é›‡ä¸»'}}</text>
            <text class="mini-sub">å¼€å§‹æ—¶é—´ï¼š{{item.startDate || '-'}}</text>
            <text class="mini-sub">æœåŠ¡åœ°å€ï¼š{{item.address || '-'}}</text>
            <view class="mini-actions">
              <button class="mini-btn contact" data-order-id="{{item.orderId}}" bindtap="onViewOrder">æŸ¥çœ‹è®¢å•</button>
            </view>
          </view>
        </view>
        <view wx:else class="empty-tip">æš‚æ— å·²è½¬è®¢å•</view>
      </view>

      <view class="worker-section card">
        <view class="section-title">èµ„æ–™ä¸æˆé•¿</view>
        <view class="rule-row">
          <text>å…¬å¼€çŠ¶æ€ï¼š{{workerInfo && workerInfo.isPublic ? 'å·²å¼€æ”¾' : 'å·²éšè—'}}</text>
          <text>è®¤è¯çŠ¶æ€ï¼š{{workerInfo && workerInfo.isVerified ? 'å·²è®¤è¯' : 'å¾…è®¤è¯'}}</text>
        </view>
        <view class="mini-actions">
          <button class="mini-btn contact" bindtap="onGoRulesTraining">å¹³å°è§„åˆ™/åŸ¹è®­</button>
        </view>
      </view>
      </view>
    </block>

    <block wx:elif="{{isPlatformHome}}">
      <view class="platform-home">
      <view class="platform-hero card">
        <view class="worker-hero-title">å¹³å°å·¥ä½œå°</view>
        <view class="platform-hero-row">
          <text class="mini-sub">èšç„¦é¢è¯•å®‰æ’ä¸ç»“æœæµè½¬</text>
          <button class="hero-btn" bindtap="onGoInterviewAdmin">å®Œæ•´ç®¡ç†</button>
        </view>
      </view>

      <view class="worker-stats card">
        <view class="stats-item">
          <text class="stats-num">{{platformStats.acceptedCount}}</text>
          <text class="stats-text">å¾…å®‰æ’</text>
        </view>
        <view class="stats-item">
          <text class="stats-num">{{platformStats.scheduledCount}}</text>
          <text class="stats-text">å¾…ç»“æœ</text>
        </view>
        <view class="stats-item">
          <text class="stats-num">{{platformStats.doneCount}}</text>
          <text class="stats-text">å·²å¤„ç†</text>
        </view>
      </view>

      <view class="worker-section card">
        <view class="section-header">
          <view class="section-title">å¾…å®‰æ’é¢è¯•</view>
          <view class="more-link" bindtap="onGoInterviewAdmin"><text>æŸ¥çœ‹æ›´å¤š ></text></view>
        </view>
        <view wx:if="{{platformAcceptedBookings.length > 0}}">
          <view class="mini-card" wx:for="{{platformAcceptedBookings}}" wx:key="_id">
            <text class="mini-title">{{item.workerName || 'é˜¿å§¨'}} / {{item.contactName || item.userNickname || 'é›‡ä¸»'}}</text>
            <text class="mini-sub">æœåŠ¡ç±»å‹ï¼š{{item.serviceType || '-'}}</text>
            <text class="mini-sub">é¢„çº¦å¼€å§‹ï¼š{{item.startDate || '-'}}</text>
            <view class="mini-actions">
              <button class="mini-btn accept" data-booking-id="{{item._id}}" bindtap="onPlatformScheduleInterview">å®‰æ’é¢è¯•</button>
            </view>
          </view>
        </view>
        <view wx:else class="empty-tip">æš‚æ— å¾…å®‰æ’é¢è¯•</view>
      </view>

      <view class="worker-section card">
        <view class="section-header">
          <view class="section-title">å¾…å½•å…¥ç»“æœ</view>
          <view class="more-link" bindtap="onGoInterviewAdmin"><text>æŸ¥çœ‹æ›´å¤š ></text></view>
        </view>
        <view wx:if="{{platformInterviewBookings.length > 0}}">
          <view class="mini-card" wx:for="{{platformInterviewBookings}}" wx:key="_id">
            <text class="mini-title">{{item.workerName || 'é˜¿å§¨'}} / {{item.contactName || item.userNickname || 'é›‡ä¸»'}}</text>
            <text class="mini-sub">é¢è¯•æ—¶é—´ï¼š{{item.interviewTime || 'å¾…å®š'}}</text>
            <view class="mini-actions">
              <button class="mini-btn reject" data-booking-id="{{item._id}}" data-passed="{{false}}" bindtap="onPlatformSetResult">ä¸é€šè¿‡</button>
              <button class="mini-btn accept" data-booking-id="{{item._id}}" data-passed="{{true}}" bindtap="onPlatformSetResult">é€šè¿‡</button>
            </view>
          </view>
        </view>
        <view wx:else class="empty-tip">æš‚æ— å¾…å½•å…¥ç»“æœ</view>
      </view>

      <view class="worker-section card">
        <view class="section-header">
          <view class="section-title">æœ€è¿‘å·²å¤„ç†</view>
          <view class="more-link" bindtap="onGoInterviewAdmin"><text>æŸ¥çœ‹æ›´å¤š ></text></view>
        </view>
        <view wx:if="{{platformDoneToday.length > 0 || platformDoneRecent7.length > 0}}">
          <view class="group-title" wx:if="{{platformDoneToday.length > 0}}">ä»Šå¤©</view>
          <view class="mini-card" wx:for="{{platformDoneToday}}" wx:key="_id">
            <text class="mini-title">{{item.workerName || 'é˜¿å§¨'}} / {{item.contactName || item.userNickname || 'é›‡ä¸»'}}</text>
            <text class="mini-sub">å½“å‰çŠ¶æ€ï¼š{{item.statusText}}</text>
            <text class="mini-sub">å¤„ç†æ—¶é—´ï¼š{{item.doneTimeText}}</text>
          </view>

          <view class="group-title" wx:if="{{platformDoneRecent7.length > 0}}">è¿‘7å¤©</view>
          <view class="mini-card" wx:for="{{platformDoneRecent7}}" wx:key="_id">
            <text class="mini-title">{{item.workerName || 'é˜¿å§¨'}} / {{item.contactName || item.userNickname || 'é›‡ä¸»'}}</text>
            <text class="mini-sub">å½“å‰çŠ¶æ€ï¼š{{item.statusText}}</text>
            <text class="mini-sub">å¤„ç†æ—¶é—´ï¼š{{item.doneTimeText}}</text>
          </view>
        </view>
        <view wx:else class="empty-tip">æš‚æ— å·²å¤„ç†è®°å½•</view>
      </view>
      </view>
    </block>

    <view class="bottom-placeholder"></view>
  </block>
</view>
